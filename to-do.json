{
  "schema_version": 1,
  "project": {
    "name": "marginshot",
    "root": "."
  },
  "source_files": [
    "SPECS.md"
  ],
  "tasks": [
    {
      "id": "T001",
      "title": "Create iOS project scaffold and two-mode navigation",
      "priority": 1,
      "status": "done",
      "details": "Set up the app shell with a horizontal swipe container for Capture and Chat plus a header showing mode and sync status.",
      "tags": [
        "ui",
        "app-structure"
      ],
      "steps": [
        "Create the Xcode project and app entry point",
        "Implement a swipe container between Capture and Chat",
        "Add a minimal header with mode label and sync status icon"
      ],
      "updated_at": "2026-01-20T14:32:03Z",
      "files": [
        "MarginShot.xcodeproj/project.pbxproj",
        "MarginShot/Assets.xcassets/AppIcon.appiconset/Contents.json",
        "MarginShot/Assets.xcassets/Contents.json",
        "MarginShot/ContentView.swift",
        "MarginShot/Info.plist",
        "MarginShot/MarginShotApp.swift",
        "MarginShot/Views/CaptureView.swift",
        "MarginShot/Views/ChatView.swift",
        "MarginShot/Views/HeaderView.swift",
        "to-do.json"
      ]
    },
    {
      "id": "T002",
      "title": "Implement onboarding and permissions flow",
      "priority": 1,
      "status": "done",
      "details": "Show a welcome screen, request camera (and optional photos) permissions, and handle denial paths.",
      "tags": [
        "ui",
        "permissions"
      ],
      "depends_on": [
        "T001"
      ],
      "updated_at": "2026-01-20T14:40:59Z",
      "files": [
        "MarginShot.xcodeproj/project.pbxproj",
        "MarginShot/ContentView.swift",
        "MarginShot/Info.plist",
        "MarginShot/Views/OnboardingView.swift",
        "to-do.json"
      ]
    },
    {
      "id": "T003",
      "title": "Bootstrap the vault filesystem and base structure",
      "priority": 1,
      "status": "done",
      "details": "Create the default vault folder tree, SYSTEM.md, INDEX.json, and STRUCTURE.txt with atomic file writes.",
      "tags": [
        "storage",
        "vault"
      ],
      "depends_on": [
        "T001"
      ],
      "updated_at": "2026-01-20T14:46:52Z",
      "files": [
        "MarginShot/ContentView.swift",
        "to-do.json"
      ]
    },
    {
      "id": "T004",
      "title": "Define the local data model and persistence layer",
      "priority": 1,
      "status": "done",
      "details": "Model Batch, Scan, Note, SyncState, Index, and Notebook entities using Core Data or SQLite with migrations.",
      "tags": [
        "data",
        "storage"
      ],
      "depends_on": [
        "T001"
      ],
      "updated_at": "2026-01-20T14:53:41Z",
      "files": [
        "MarginShot.xcodeproj/project.pbxproj",
        "MarginShot/ContentView.swift",
        "MarginShot/MarginShotApp.swift",
        "MarginShot/PersistenceController.swift",
        "to-do.json"
      ]
    },
    {
      "id": "T005",
      "title": "Build the capture camera and scanning pipeline",
      "priority": 1,
      "status": "done",
      "details": "Live camera preview with document detection, auto-crop, deskew, enhancement, and local image storage.",
      "tags": [
        "capture",
        "vision"
      ],
      "depends_on": [
        "T001",
        "T004"
      ],
      "updated_at": "2026-01-20T15:04:43Z",
      "files": [
        "MarginShot/Views/CaptureView.swift",
        "to-do.json"
      ]
    },
    {
      "id": "T006",
      "title": "Add batch capture and inbox management UI",
      "priority": 1,
      "status": "done",
      "details": "Create batch sessions, track scan status, show inbox count, and allow review/retry of failed items.",
      "tags": [
        "capture",
        "inbox",
        "ui"
      ],
      "depends_on": [
        "T004",
        "T005"
      ],
      "updated_at": "2026-01-20T15:18:44Z",
      "files": [
        "MarginShot/Views/CaptureView.swift",
        "to-do.json"
      ]
    },
    {
      "id": "T007",
      "title": "Implement processing queue and background tasks",
      "priority": 1,
      "status": "done",
      "details": "Queue processing per notebook, schedule BGTaskScheduler jobs, and honor Wi-Fi/charging constraints.",
      "tags": [
        "processing",
        "background"
      ],
      "depends_on": [
        "T004",
        "T006"
      ],
      "updated_at": "2026-01-20T15:28:12Z",
      "files": [
        "MarginShot.xcodeproj/project.pbxproj",
        "MarginShot/ContentView.swift",
        "MarginShot/Info.plist",
        "MarginShot/MarginShotApp.swift",
        "MarginShot/ProcessingQueue.swift",
        "MarginShot/Views/CaptureView.swift",
        "to-do.json"
      ]
    },
    {
      "id": "T008",
      "title": "Integrate the Gemini LLM client",
      "priority": 1,
      "status": "done",
      "details": "Implement network client, auth configuration, retries/backoff, and response parsing.",
      "tags": [
        "llm",
        "network"
      ],
      "depends_on": [
        "T001"
      ],
      "updated_at": "2026-01-20T15:32:57Z",
      "files": [
        "MarginShot.xcodeproj/project.pbxproj",
        "MarginShot/GeminiClient.swift",
        "MarginShot/Info.plist",
        "to-do.json"
      ]
    },
    {
      "id": "T009",
      "title": "Build transcription, structure, and classification pipeline",
      "priority": 1,
      "status": "done",
      "details": "Support fast/balanced/best modes, validate JSON outputs, and preserve raw transcripts.",
      "tags": [
        "llm",
        "processing"
      ],
      "depends_on": [
        "T007",
        "T008"
      ],
      "updated_at": "2026-01-20T15:47:19Z",
      "files": [
        "MarginShot.xcodeproj/project.pbxproj",
        "MarginShot/GeminiClient.swift",
        "MarginShot/PersistenceController.swift",
        "MarginShot/ProcessingPipeline.swift",
        "MarginShot/ProcessingQueue.swift",
        "to-do.json"
      ]
    },
    {
      "id": "T010",
      "title": "Implement vault writer and Markdown note generation",
      "priority": 1,
      "status": "done",
      "details": "Write daily notes, store scan images and transcripts, and apply file operations atomically.",
      "tags": [
        "vault",
        "processing"
      ],
      "depends_on": [
        "T003",
        "T009"
      ],
      "updated_at": "2026-01-20T15:58:42Z",
      "files": [
        "MarginShot/ProcessingPipeline.swift",
        "MarginShot/ProcessingQueue.swift",
        "to-do.json"
      ]
    },
    {
      "id": "T011",
      "title": "Create the indexer and local search store",
      "priority": 1,
      "status": "done",
      "details": "Maintain INDEX.json and STRUCTURE.txt, plus a SQLite FTS index for fast retrieval.",
      "tags": [
        "index",
        "search"
      ],
      "depends_on": [
        "T010"
      ],
      "updated_at": "2026-01-20T16:05:32Z",
      "files": [
        "MarginShot.xcodeproj/project.pbxproj",
        "MarginShot/ProcessingQueue.swift",
        "MarginShot/VaultIndexStore.swift",
        "to-do.json"
      ]
    },
    {
      "id": "T012",
      "title": "Implement retrieval for chat grounding",
      "priority": 1,
      "status": "done",
      "details": "Query index + FTS, expand via wiki-links, and build a context bundle for the chat agent.",
      "tags": [
        "chat",
        "search"
      ],
      "depends_on": [
        "T011"
      ],
      "updated_at": "2026-01-20T16:12:05Z",
      "files": [
        "MarginShot/VaultIndexStore.swift",
        "to-do.json"
      ]
    },
    {
      "id": "T013",
      "title": "Implement the chat agent and grounding rules",
      "priority": 1,
      "status": "done",
      "details": "Call the LLM with context and system rules, enforce grounded responses, and return sources metadata.",
      "tags": [
        "chat",
        "llm"
      ],
      "depends_on": [
        "T008",
        "T012"
      ],
      "updated_at": "2026-01-20T16:17:38Z",
      "files": [
        "MarginShot.xcodeproj/project.pbxproj",
        "MarginShot/ChatAgent.swift",
        "to-do.json"
      ]
    },
    {
      "id": "T014",
      "title": "Build the chat UI with sources disclosure",
      "priority": 1,
      "status": "done",
      "details": "Chat bubbles, input bar, typing indicator, and collapsible used sources with open actions.",
      "tags": [
        "chat",
        "ui"
      ],
      "depends_on": [
        "T013"
      ],
      "updated_at": "2026-01-20T16:28:42Z",
      "files": [
        "MarginShot/Views/ChatView.swift",
        "to-do.json"
      ]
    },
    {
      "id": "T015",
      "title": "Add the Ask about this capture-to-chat flow",
      "priority": 1,
      "status": "done",
      "details": "After finishing a batch, jump to chat and prioritize the latest batch context.",
      "tags": [
        "chat",
        "capture",
        "ui"
      ],
      "depends_on": [
        "T006",
        "T014"
      ],
      "updated_at": "2026-01-20T16:43:26Z",
      "files": [
        "MarginShot/ChatAgent.swift",
        "MarginShot/ContentView.swift",
        "MarginShot/ProcessingQueue.swift",
        "MarginShot/VaultIndexStore.swift",
        "MarginShot/Views/CaptureView.swift",
        "MarginShot/Views/ChatView.swift",
        "to-do.json"
      ]
    },
    {
      "id": "T016",
      "title": "Create settings screens and basic toggles",
      "priority": 1,
      "status": "done",
      "details": "Implement grouped settings for Processing, Sync, Organization, Privacy, and Advanced toggles.",
      "tags": [
        "settings",
        "ui"
      ],
      "depends_on": [
        "T001"
      ],
      "updated_at": "2026-01-20T16:49:07Z",
      "files": [
        "MarginShot.xcodeproj/project.pbxproj",
        "MarginShot/Views/CaptureView.swift",
        "MarginShot/Views/SettingsView.swift",
        "to-do.json"
      ]
    },
    {
      "id": "T017",
      "title": "Implement folder export as a sync destination",
      "priority": 1,
      "status": "done",
      "details": "Allow selecting a folder destination and run background sync after processing or apply-to-vault.",
      "tags": [
        "sync",
        "storage"
      ],
      "depends_on": [
        "T010",
        "T016"
      ],
      "updated_at": "2026-01-20T16:57:55Z",
      "files": [
        "MarginShot/ProcessingQueue.swift",
        "MarginShot/Views/SettingsView.swift",
        "to-do.json"
      ]
    },
    {
      "id": "T018",
      "title": "Add sync status UI and error handling",
      "priority": 1,
      "status": "done",
      "details": "Show sync status in the header, expose settings banners, and add retry flows.",
      "tags": [
        "sync",
        "ui"
      ],
      "depends_on": [
        "T017"
      ],
      "updated_at": "2026-01-20T17:07:25Z",
      "files": [
        "MarginShot/SyncStatusStore.swift",
        "MarginShot/Views/HeaderView.swift",
        "MarginShot/ContentView.swift",
        "MarginShot/MarginShotApp.swift",
        "MarginShot/Views/SettingsView.swift",
        "MarginShot/ProcessingQueue.swift",
        "MarginShot.xcodeproj/project.pbxproj",
        "to-do.json"
      ]
    },
    {
      "id": "T019",
      "title": "Implement privacy and security baseline",
      "priority": 1,
      "status": "done",
      "details": "Add LLM image send toggle with disclosure text and store tokens securely in Keychain.",
      "tags": [
        "privacy",
        "security"
      ],
      "depends_on": [
        "T008",
        "T016"
      ],
      "updated_at": "2026-01-20T17:21:35Z",
      "files": [
        "MarginShot/GeminiClient.swift",
        "MarginShot/ProcessingQueue.swift",
        "MarginShot/Views/ChatView.swift",
        "MarginShot/Views/SettingsView.swift",
        "to-do.json"
      ]
    },
    {
      "id": "T020",
      "title": "Add system rules file management and editor",
      "priority": 2,
      "status": "done",
      "details": "Maintain SYSTEM.md defaults and allow editing in Settings; apply rules in prompts.",
      "tags": [
        "system-rules",
        "settings",
        "llm"
      ],
      "depends_on": [
        "T003",
        "T016",
        "T008"
      ],
      "updated_at": "2026-01-20T17:38:49Z",
      "files": [
        "MarginShot.xcodeproj/project.pbxproj",
        "MarginShot/ContentView.swift",
        "MarginShot/ProcessingPipeline.swift",
        "MarginShot/SystemRulesStore.swift",
        "MarginShot/Views/SettingsView.swift",
        "MarginShot/Views/SystemRulesEditorView.swift",
        "to-do.json"
      ]
    },
    {
      "id": "T021",
      "title": "Implement apply-to-vault workflow",
      "priority": 2,
      "status": "done",
      "details": "Parse fileOps from chat, apply changes in a single transaction, and surface success/failure.",
      "tags": [
        "chat",
        "vault"
      ],
      "depends_on": [
        "T010",
        "T014"
      ],
      "updated_at": "2026-01-20T17:53:47Z",
      "files": [
        "MarginShot/ChatAgent.swift",
        "MarginShot/ProcessingPipeline.swift",
        "MarginShot/ProcessingQueue.swift",
        "MarginShot/VaultIndexStore.swift",
        "MarginShot/Views/ChatView.swift",
        "to-do.json"
      ]
    },
    {
      "id": "T022",
      "title": "Add wiki-linking and entity page creation",
      "priority": 2,
      "status": "done",
      "details": "Detect entities/projects, create pages lazily, and insert wiki-links in notes.",
      "tags": [
        "linking",
        "vault"
      ],
      "depends_on": [
        "T010",
        "T011"
      ],
      "updated_at": "2026-01-20T18:03:58Z",
      "files": [
        "MarginShot/ProcessingPipeline.swift",
        "MarginShot/ProcessingQueue.swift",
        "to-do.json"
      ]
    },
    {
      "id": "T023",
      "title": "Implement task extraction and consolidation",
      "priority": 3,
      "status": "done",
      "details": "Optionally aggregate tasks into 13_tasks and keep them updated during processing.",
      "tags": [
        "tasks",
        "vault"
      ],
      "depends_on": [
        "T010",
        "T016"
      ],
      "updated_at": "2026-01-20T18:54:48Z",
      "files": [
        "MarginShot/ProcessingQueue.swift",
        "to-do.json"
      ]
    },
    {
      "id": "T024",
      "title": "Add topic pages and optional Johnny.Decimal mode",
      "priority": 3,
      "status": "done",
      "details": "Generate _topics pages and support strict numbering for folder names when enabled.",
      "tags": [
        "topics",
        "organization"
      ],
      "depends_on": [
        "T003",
        "T016"
      ],
      "updated_at": "2026-01-20T19:14:28Z",
      "files": [
        "MarginShot.xcodeproj/project.pbxproj",
        "MarginShot/ChatAgent.swift",
        "MarginShot/ContentView.swift",
        "MarginShot/OrganizationSettings.swift",
        "MarginShot/ProcessingPipeline.swift",
        "MarginShot/ProcessingQueue.swift",
        "MarginShot/TopicPageStore.swift",
        "MarginShot/Views/SettingsView.swift",
        "to-do.json"
      ]
    },
    {
      "id": "T025",
      "title": "Implement GitHub destination sync",
      "priority": 2,
      "status": "done",
      "details": "Add OAuth flow, repo selection, and background sync with retries.",
      "tags": [
        "sync",
        "github"
      ],
      "depends_on": [
        "T017",
        "T018"
      ],
      "updated_at": "2026-01-20T18:24:30Z",
      "files": [
        "MarginShot/GeminiClient.swift",
        "MarginShot/Info.plist",
        "MarginShot/ProcessingQueue.swift",
        "MarginShot/Views/SettingsView.swift",
        "to-do.json"
      ]
    },
    {
      "id": "T026",
      "title": "Add advanced review and diff mode",
      "priority": 3,
      "status": "done",
      "details": "Show file list and lightweight diffs before apply-to-vault when advanced review is enabled.",
      "tags": [
        "review",
        "diff"
      ],
      "depends_on": [
        "T021",
        "T016"
      ],
      "updated_at": "2026-01-20T19:23:01Z",
      "files": [
        "MarginShot/Views/ApplyReviewView.swift",
        "MarginShot/Views/ChatView.swift",
        "to-do.json"
      ]
    },
    {
      "id": "T027",
      "title": "Support multiple notebooks",
      "priority": 3,
      "status": "done",
      "details": "Implement notebook selection in capture, per-notebook rules, and overrides in data model.",
      "tags": [
        "notebooks",
        "data"
      ],
      "depends_on": [
        "T004",
        "T016",
        "T006"
      ],
      "updated_at": "2026-01-20T19:37:08Z",
      "files": [
        "MarginShot.xcodeproj/project.pbxproj",
        "MarginShot/ProcessingPipeline.swift",
        "MarginShot/ProcessingQueue.swift",
        "MarginShot/SystemRulesStore.swift",
        "MarginShot/Views/CaptureView.swift",
        "MarginShot/Views/NotebookPickerView.swift",
        "MarginShot/Views/SettingsView.swift",
        "to-do.json"
      ]
    },
    {
      "id": "T028",
      "title": "Add vault export as ZIP",
      "priority": 2,
      "status": "done",
      "details": "Provide a Settings action to export the vault as a ZIP via the share sheet.",
      "tags": [
        "export",
        "vault"
      ],
      "depends_on": [
        "T010",
        "T016"
      ],
      "updated_at": "2026-01-20T18:30:30Z",
      "files": [
        "MarginShot/Views/SettingsView.swift",
        "to-do.json"
      ]
    },
    {
      "id": "T029",
      "title": "Implement local encryption option",
      "priority": 4,
      "status": "done",
      "details": "Encrypt vault data at rest if supported and manage keys securely.",
      "tags": [
        "security",
        "encryption"
      ],
      "depends_on": [
        "T019"
      ],
      "updated_at": "2026-01-20T20:09:29Z",
      "files": [
        "MarginShot.xcodeproj/project.pbxproj",
        "MarginShot/ContentView.swift",
        "MarginShot/GeminiClient.swift",
        "MarginShot/ProcessingPipeline.swift",
        "MarginShot/ProcessingQueue.swift",
        "MarginShot/SystemRulesStore.swift",
        "MarginShot/TopicPageStore.swift",
        "MarginShot/VaultFileStore.swift",
        "MarginShot/VaultIndexStore.swift",
        "MarginShot/Views/ApplyReviewView.swift",
        "MarginShot/Views/CaptureView.swift",
        "MarginShot/Views/ChatView.swift",
        "MarginShot/Views/SettingsView.swift",
        "to-do.json"
      ]
    },
    {
      "id": "T030",
      "title": "Add performance instrumentation and targets",
      "priority": 3,
      "status": "done",
      "details": "Measure capture latency, processing throughput, and chat retrieval timing to hit target budgets.",
      "tags": [
        "performance"
      ],
      "depends_on": [
        "T005",
        "T009",
        "T012"
      ],
      "updated_at": "2026-01-20T19:49:31Z",
      "files": [
        "MarginShot.xcodeproj/project.pbxproj",
        "MarginShot/ChatAgent.swift",
        "MarginShot/PerformanceMetricsStore.swift",
        "MarginShot/ProcessingQueue.swift",
        "MarginShot/Views/CaptureView.swift",
        "MarginShot/Views/SettingsView.swift",
        "to-do.json"
      ]
    },
    {
      "id": "T031",
      "title": "Create test coverage and QA plan",
      "priority": 2,
      "status": "done",
      "details": "Add unit tests for pipeline logic, integration tests for vault/sync, and UI smoke tests.",
      "tags": [
        "tests",
        "qa"
      ],
      "depends_on": [
        "T010",
        "T017",
        "T014"
      ],
      "updated_at": "2026-01-20T18:46:01Z",
      "files": [
        "MarginShot.xcodeproj/project.pbxproj",
        "MarginShot/MarginShotApp.swift",
        "MarginShotTests/PipelineLogicTests.swift",
        "MarginShotTests/VaultSyncIntegrationTests.swift",
        "MarginShotUITests/MarginShotUITests.swift",
        "QA.md",
        "to-do.json"
      ]
    },
    {
      "id": "T032",
      "title": "Resolve open product decisions and defaults",
      "priority": 1,
      "status": "done",
      "details": "Decide default sync behavior, transcript storage format, and multi-notebook timing; update defaults and copy.",
      "tags": [
        "product"
      ],
      "updated_at": "2026-01-20T17:32:25Z",
      "files": [
        "MarginShot/Views/OnboardingView.swift",
        "MarginShot/Views/SettingsView.swift",
        "SPECS.md",
        "to-do.json"
      ]
    },
    {
      "id": "T033",
      "title": "Honor auto-process inbox toggle in processing scheduler",
      "priority": 2,
      "status": "done",
      "details": "Gate enqueue/background processing on the auto-process setting and resume queued work when re-enabled.",
      "tags": [
        "processing",
        "settings"
      ],
      "updated_at": "2026-01-20T20:33:19Z",
      "files": [
        "MarginShot/ProcessingQueue.swift",
        "MarginShot/Views/SettingsView.swift",
        "to-do.json"
      ]
    },
    {
      "id": "T034",
      "title": "Respect linking toggle for wiki-links and entity page creation",
      "priority": 3,
      "status": "done",
      "details": "Disable link injection, entity page creation, and prompt instructions when linking is turned off.",
      "tags": [
        "organization",
        "vault",
        "llm"
      ],
      "updated_at": "2026-01-20T20:41:25Z",
      "files": [
        "MarginShot/OrganizationSettings.swift",
        "MarginShot/ProcessingPipeline.swift",
        "MarginShot/ProcessingQueue.swift",
        "MarginShot/SystemRulesStore.swift",
        "MarginShot/VaultIndexStore.swift",
        "to-do.json"
      ]
    },
    {
      "id": "T035",
      "title": "Make processing failures retryable instead of permanent errors",
      "priority": 1,
      "status": "done",
      "details": "If the Gemini API key is missing or a scan fails, keep batches queued/blocked and provide a retry action that requeues LLM processing.",
      "tags": [
        "processing",
        "reliability"
      ],
      "updated_at": "2026-01-20T20:30:35Z",
      "files": [
        "MarginShot/PersistenceController.swift",
        "MarginShot/ProcessingQueue.swift",
        "MarginShot/Views/CaptureView.swift",
        "to-do.json"
      ]
    },
    {
      "id": "T036",
      "title": "Process scans in deterministic order within a batch",
      "priority": 3,
      "status": "done",
      "details": "Sort batch scans by page number or capture time before processing so daily notes append in the right sequence.",
      "tags": [
        "processing",
        "data"
      ],
      "updated_at": "2026-01-20T20:45:40Z",
      "files": [
        "MarginShot/ProcessingQueue.swift",
        "to-do.json"
      ]
    },
    {
      "id": "T037",
      "title": "Require network connectivity before LLM processing and background tasks",
      "priority": 2,
      "status": "done",
      "details": "When auto-processing with Gemini, only run when any network is available (cellular or Wi-Fi). Set BGProcessingTaskRequest.requiresNetworkConnectivity = true and update hasRequiredNetwork to check general connectivity when Wi-Fi-only is off; reschedule instead of marking scans error when offline.",
      "tags": [
        "processing",
        "network",
        "background"
      ],
      "files": [
        "MarginShot/ProcessingQueue.swift",
        "to-do.json"
      ],
      "updated_at": "2026-01-20T20:57:55Z"
    },
    {
      "id": "T038",
      "title": "Make batch retry reprocess scans missing processed images",
      "priority": 2,
      "status": "done",
      "details": "In Capture inbox retry, handle scans in error/preprocessing states without processedImagePath by rerunning DocumentProcessingPipeline from raw images (similar to retryScan) so batch retry can recover all failed scans.",
      "tags": [
        "capture",
        "reliability"
      ],
      "files": [
        "MarginShot/Views/CaptureView.swift",
        "to-do.json"
      ],
      "updated_at": "2026-01-20T21:04:20Z"
    },
    {
      "id": "T039",
      "title": "Clean up decrypted temp copies opened from chat",
      "priority": 3,
      "status": "done",
      "details": "When local encryption is enabled, opening a note from chat writes a decrypted copy under the temp marginshot-decrypted folder; add cleanup (on open completion or app launch) to avoid leaving plaintext files on disk.",
      "tags": [
        "security",
        "chat",
        "vault"
      ],
      "files": [
        "MarginShot/ContentView.swift",
        "MarginShot/VaultFileStore.swift",
        "to-do.json"
      ],
      "updated_at": "2026-01-20T21:11:11Z"
    },
    {
      "id": "T040",
      "title": "Defer decrypted temp copy creation until user opens a source",
      "priority": 2,
      "status": "done",
      "details": "Source rows currently call VaultFileStore.decryptedCopyURL during render, which writes plaintext temp files for every listed source. Only decrypt/write on Open tap and base the button enabled state on vault file existence.",
      "tags": [
        "security",
        "chat",
        "vault"
      ],
      "files": [
        "MarginShot/Views/ChatView.swift",
        "to-do.json"
      ],
      "updated_at": "2026-01-20T21:27:36Z"
    },
    {
      "id": "T041",
      "title": "Use proper form encoding for GitHub OAuth token exchange",
      "priority": 2,
      "status": "done",
      "details": "GitHubAPI.exchangeCodeForToken builds an application/x-www-form-urlencoded body with urlQueryAllowed encoding. Switch to RFC 3986-compliant percent encoding so redirect_uri and verifier characters are safely encoded.",
      "tags": [
        "github",
        "auth",
        "network"
      ],
      "files": [
        "MarginShot/ProcessingQueue.swift",
        "to-do.json"
      ],
      "updated_at": "2026-01-20T21:30:31Z"
    },
    {
      "id": "T042",
      "title": "Refresh task consolidation after apply-to-vault updates",
      "priority": 3,
      "status": "done",
      "details": "VaultApplyService updates index and topic pages but does not re-run TaskConsolidator; run refresh after apply so Tasks.md reflects chat-applied edits.",
      "tags": [
        "vault",
        "tasks"
      ],
      "files": [
        "MarginShot/ProcessingQueue.swift",
        "to-do.json"
      ],
      "updated_at": "2026-01-20T21:35:31Z"
    },
    {
      "id": "T043",
      "title": "Preserve Gemini API key if Keychain migration fails",
      "priority": 4,
      "status": "done",
      "details": "GeminiConfiguration.load removes GeminiAPIKey from UserDefaults even if Keychain save fails; only remove after a successful Keychain write and surface failure.",
      "tags": [
        "security",
        "settings"
      ],
      "files": [
        "MarginShot/GeminiClient.swift",
        "MarginShot/Views/ChatView.swift",
        "to-do.json"
      ],
      "updated_at": "2026-01-20T21:41:59Z"
    },
    {
      "id": "T044",
      "title": "Prevent concurrent processing runs across background and foreground triggers",
      "priority": 2,
      "status": "done",
      "details": "Ensure ProcessingQueue uses a single shared guard when invoked from BGTaskScheduler and foreground enqueue calls to avoid double-processing batches or racing state updates.",
      "tags": [
        "processing",
        "background",
        "reliability"
      ],
      "files": [
        "MarginShot/ProcessingQueue.swift",
        "to-do.json"
      ],
      "updated_at": "2026-01-20T22:03:19Z"
    },
    {
      "id": "T045",
      "title": "Mirror deletions in sync destinations",
      "priority": 3,
      "status": "done",
      "details": "FolderSyncer and GitHubSyncer currently only upload/copy changed files; add deletion handling so removed vault files are deleted remotely (with safeguards against non-vault files).",
      "tags": [
        "sync",
        "reliability"
      ],
      "files": [
        "MarginShot/ProcessingQueue.swift",
        "to-do.json"
      ],
      "updated_at": "2026-01-20T22:16:11Z"
    },
    {
      "id": "T046",
      "title": "Define disable-encryption behavior and rebuild search index",
      "priority": 3,
      "status": "done",
      "details": "When local encryption is turned off, either decrypt the vault or warn that files remain encrypted; ensure FTS search is rebuilt when encryption is disabled so retrieval returns full-text results.",
      "tags": [
        "privacy",
        "security",
        "search"
      ],
      "files": [
        "MarginShot/VaultFileStore.swift",
        "MarginShot/VaultIndexStore.swift",
        "MarginShot/Views/SettingsView.swift",
        "to-do.json"
      ],
      "updated_at": "2026-01-20T22:24:40Z"
    },
    {
      "id": "T047",
      "title": "Reset GitHub sync baseline when repository selection changes",
      "priority": 2,
      "status": "done",
      "details": "Selecting a new repo/branch keeps githubLastSyncAt from the prior repo, which can skip the initial upload. Clear or scope the last sync timestamp per repo/branch when the selection changes.",
      "tags": [
        "sync",
        "github",
        "reliability"
      ],
      "files": [
        "MarginShot/ProcessingQueue.swift",
        "MarginShot/Views/SettingsView.swift",
        "to-do.json"
      ],
      "updated_at": "2026-01-20T22:56:50Z"
    },
    {
      "id": "T048",
      "title": "Avoid sync errors when offline by gating GitHub sync on network availability",
      "priority": 2,
      "status": "done",
      "details": "Before GitHub sync, check for any network (or Wi-Fi if required). When offline, skip the sync attempt and keep status idle rather than marking an error.",
      "tags": [
        "sync",
        "network",
        "reliability"
      ],
      "files": [
        "MarginShot/ProcessingQueue.swift",
        "MarginShot/SyncStatusStore.swift",
        "to-do.json"
      ],
      "updated_at": "2026-01-20T23:11:31Z"
    },
    {
      "id": "T049",
      "title": "Handle open batches left after app restarts",
      "priority": 1,
      "status": "done",
      "details": "Open batches with pending scans stay stuck and never reach processing if the app is closed before Finish. Detect open batches on launch or in Inbox and provide a way to queue or resume them.",
      "tags": [
        "capture",
        "processing",
        "reliability"
      ],
      "files": [
        "MarginShot/Views/CaptureView.swift",
        "to-do.json"
      ],
      "updated_at": "2026-01-20T23:52:55Z"
    },
    {
      "id": "T050",
      "title": "Make VaultSyncIntegrationTests independent of user defaults",
      "priority": 2,
      "status": "done",
      "details": "Set organization style/encryption defaults in test setup and read vault files via VaultFileStore (or force encryption off) so tests do not fail when preferences change.",
      "tags": [
        "tests",
        "reliability"
      ],
      "files": [
        "MarginShotTests/VaultSyncIntegrationTests.swift",
        "MarginShot/OrganizationSettings.swift",
        "MarginShot/ContentView.swift",
        "MarginShot/ProcessingQueue.swift"
      ],
      "updated_at": "2026-01-21T00:14:20Z"
    }
  ]
}
